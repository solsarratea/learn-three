<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>My first three.js app</title>
        <script src="/three.min.js"></script>
        <script type="text/javascript" src="dat.gui.min.js"></script>
  </head>
	<style>
		body { margin: 0; }
		canvas { display: block; }
	</style>
	</head>
	<body>  
		<script id="vertexShader" type="x-shader/x-fragment">
			varying vec2 texCoordVarying;
  
			void main() {
				texCoordVarying = uv;
				gl_Position =   projectionMatrix * 
								modelViewMatrix * 
								vec4(position,1.0);
			}
        </script>
        <script id="fragmentShader" type="x-shader/x-fragment">
            varying vec2 texCoordVarying;
            uniform sampler2D texture;
            uniform vec3 color1;
            uniform vec3 color2;
        
            void main( void ){
              vec2 uv = texCoordVarying;
              vec3 sc = mix( color1, color2, min( texture2D( texture, uv ).g * 2.0, 1.0 ));

              gl_FragColor = vec4( texture2D( texture, uv ).xyz, 1.0);
            }
        </script>

        <script id="grayScott" type="x-shader/x-vertex">
            uniform sampler2D texture2;
            varying vec2 texCoordVarying;
            uniform float dA;
            uniform float dB;
            uniform float dT;
            uniform float kill;
            uniform float feed;
            uniform int timer;
            uniform sampler2D start;

            vec2 pos;
            vec2 inText;
            vec2 offset;
            

            vec2 getLaplace() {
                vec2 offset = vec2( 1.0 ) / texCoordVarying;
                vec2 pos0 = pos + vec2( -offset.x,  -offset.y );
                vec2 pos1 = pos + vec2(       0.0,  -offset.y );
                vec2 pos2 = pos + vec2(  offset.x,  -offset.y );
                vec2 pos3 = pos + vec2( -offset.x,        0.0 );
                vec2 pos4 = pos + vec2(       0.0,        0.0 );
                vec2 pos5 = pos + vec2(  offset.x,        0.0 );
                vec2 pos6 = pos + vec2( -offset.x,   offset.y );
                vec2 pos7 = pos + vec2(       0.0,   offset.y );
                vec2 pos8 = pos + vec2(  offset.x,   offset.y );
        
                vec2 col0 = texture2D( texture2, pos0 ).rg;
                vec2 col1 = texture2D( texture2, pos1 ).rg;
                vec2 col2 = texture2D( texture2, pos2 ).rg;
                vec2 col3 = texture2D( texture2, pos3 ).rg;
                vec2 col4 = texture2D( texture2, pos4 ).rg;
                vec2 col5 = texture2D( texture2, pos5 ).rg;
                vec2 col6 = texture2D( texture2, pos6 ).rg;
                vec2 col7 = texture2D( texture2, pos7 ).rg;
                vec2 col8 = texture2D( texture2, pos8 ).rg;
        
                return col0 * 0.05 + col1 * 0.2 + col2 * 0.05 +
                       col3 * 0.2  - col4 * 1.0 + col5 * 0.2  +
                       col6 * 0.05 + col7 * 0.2 + col8 * 0.05;
            }
  
            void main()
            {
              vec2 color=vec2(0.);
              vec2 inText = texture2D(texture2,texCoordVarying).rg;
  
              if( timer == 1 ) {
                color = vec2( 1.0, step( 0.1, texture2D( start, texCoordVarying ) ) * 0.3 );

            }else{
                offset = vec2( 1.0 ) / texCoordVarying;

                float a = inText.r;
                float b = inText.g;

                float reaction = a * b * b;
                vec2 laplace = getLaplace();
    
                float red = ( dA * laplace.r ) - reaction + ( feed * ( 1.0 - a ) );
                float green = ( dB * laplace.g ) +  reaction - ( ( kill + feed ) * b );    
                color = inText + vec2( red, green ) * dT;
            
            }
    
                gl_FragColor = vec4( texture2D(texture2,texCoordVarying), 1.0 );
            }
  
      </script>
		<script src="/gray-scott.js"></script>
	</body>
</html>